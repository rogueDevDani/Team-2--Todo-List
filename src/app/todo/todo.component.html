<!-- Main Background Box-->
<div class="app-wrap">
  Â  Â  <div class="card todo-box">
    Â  Â  Â  Â  <div class="title-row">
      Â  Â  Â  <img class="leaf" src="" alt="Hidden Leaf Symbol" /> <!--Fix: NEED TO ADD HIDDEN LEAF SYMBOL BEFORE-->
      Â  Â  Â  <h2>Naruto Mission Tracker</h2>
      Â  Â  </div>

<!-- Battle Mechanics-->
    Â  Â  Â  Â  <div class="battle">

      <!--Streak-->
      <div class="streak-counter">
        ğŸ”¥ STREAK: <strong>{{currentStreak}}</strong>
      </div>
      
      <!--Level Display-->
      <div class="level-display">
        <div class="scroll-image">
          <img src="scroll_small.png" alt="Scroll Image">
        </div>
        <div class="level-number">
          Level {{levelIndex + 1}}
        </div>
      </div>
    
      <!--Player/ oppenent battle row-->
      <div class="battle-container">
        <!-- Naruto -->
        <div class="fighter-box_left-fighter">
          <img src="naruto_sprite.png" class="fighter-img">
          <div class="fighter-label">Naruto</div>
        </div>

        <!-- HP Bar -->
        <div class="hp-wrapper">
          <div class="single-hp-bar">
            <div class="hp-fill blue" [style.width.%]="playerProgressPercentage"></div>
          </div>
          <div class="hp-readout">
            <span class="naruto-progress">{{playerProgressPercentage | number:'1.0-0'}}%</span>
            <span class="opponent-progress">{{100 - playerProgressPercentage | number:'1.0-0'}}%</span>
          </div>
        </div>

        <div class="versus">VS</div>

        <!-- Opponent -->
        <div class="fighter-box_right-fighter">
          <img src="mizuki_sprite.png" alt="Mizuki" class="fighter-img">
          <div class="fighter-label">{{currentOpponentName}}</div> <!--FIX: Change Sprites with opponents-->
        </div>
      </div>

<!--New game and restart buttons-->
      <div class="battle-actions">
        <button class="btn secondary small-btn danger" (click)="startNewGame()">New Game (Lvl 1)</button>
        <button class="btn secondary small-btn" (click)="resetLevel()">Reset Battle</button>
      </div>
      Â  Â 
    </div>

<!--Attack Message-->
    Â  Â  Â  Â  Â  Â  <div class="attack-area" *ngIf="showAttack">
      Â  Â  Â  <div class="attack-text">{{ attackText }}</div>
      Â  Â  Â  <img *ngIf="attackGifUrl" [src]="attackGifUrl" class="attack-gif" alt="Naruto Attack" />
      Â  Â  </div>

<!--User Input row-->

    Â  Â  Â  Â  <div class="form-row">
      Â  Â  Â  <input type="text" [(ngModel)]="newTask" placeholder="Enter your mission..." />

      <label> Mission Priority:
        <select [(ngModel)]="priority">
          Â  Â  Â  Â  <option id="low" value="low">Low</option>
          Â  Â  Â  Â  <option id="medium" value="medium">Medium</option>
          Â  Â  Â  Â  <option id="high" value="high">High</option>
          Â  Â  Â  </select>
      </label>
      Â  Â  Â 
      <label>Due date:
        <input type="date" [(ngModel)]="newDueDate" class="date-input-field" placeholder="Due Date">
      </label>
      <button class="btn" (click)="addTask()">Add Mission</button>
      Â  Â  Â 
      Â  Â 
    </div>

 <!--Mission lists aka user inputed tasks-->

    Â  Â  Â  Â  <div class="list">
      Â  Â  Â  <div *ngIf="tasks.length===0" class="empty">No missions yet â€” add one to start the battle.</div>

      Â  Â  Â  <div class="task" *ngFor="let t of tasks" [class.editing-task]="t.editing">
        <ng-container *ngIf="!t.editing">
          <div class="left">
            <input type="checkbox" [(ngModel)]="t.completed" (change)="toggleComplete(t)" />
            <div class="meta">
              <div [class.done]="t.completed" class="name">{{t.name}}</div>
              <div class="small">Due: <span>{{t.dueDate || 'â€”'}}</span></div>
            </div>
          </div>
          <div class="right">
            <div class="priority" [ngClass]="t.priority">{{t.priority | uppercase}}</div>
            <button class="edit-btn" (click)="editTask(t)">âœï¸</button>
            <button class="del-btn" (click)="removeTask(t.id)">ğŸ—‘ï¸</button>
          </div>
        </ng-container>

        <ng-container *ngIf="t.editing">
          <div class="edit-fields-wrap">
            <input type="text" [(ngModel)]="t.name" class="edit-input" placeholder="Mission Name" />
            <select [(ngModel)]="t.priority" class="edit-select">
              <option value="low">Low</option>
              <option value="medium">Medium</option>
              <option value="high">High</option>
            </select>
            <input type="date" [(ngModel)]="t.dueDate" class="edit-date-input" />
          </div>
          <div class="right edit-controls">
            <button class="btn small-btn save-btn" (click)="saveEdit(t)">Save</button>
            <button class="btn secondary small-btn cancel-btn" (click)="cancelEdit(t)">Cancel</button>
          </div>
        </ng-container>
        Â  Â  Â 
      </div>
      Â  Â  </div>
    Â  </div>

<!--Rewards-->
  <div class="rewards-overlay" *ngIf="showRewardsOverlay">
    <button class="close-btn" (click)="toggleRewardsOverlay()">âŒ</button>
    <div class="hud-title">Permanent Rewards (Milestones)</div>
    <p class="overlay-hint">Total Completed: <strong>{{totalCompletedMissions}}</strong> Missions</p>

    <div class="reward-list-scroll">
      <div *ngFor="let reward of rewards" class="reward-item">
        <span [style.color]="reward.unlocked ? '#76ff03' : '#ffb347'">
          {{ reward.unlocked ? 'âœ…' : 'ğŸ”’' }}
          <strong class="reward-name">{{ reward.name }}</strong>
        </span>
        <span class="milestone">({{ reward.milestone }} Missions)</span>
        <div class="effect-desc" [style.color]="reward.unlocked ? '#bdf7c9' : 'var(--muted)'">
          {{ reward.unlocked ? reward.effect : reward.description }}
        </div>
      </div>
    </div>
  </div>
  Â  Â  <div *ngIf="showAttack && !attackGifUrl" class="popup">{{ attackText }}</div>

  <button class="rewards-btn fixed-btn" (click)="toggleRewardsOverlay()">
    ğŸ“œ Rewards
  </button>
</div>